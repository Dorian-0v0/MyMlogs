# 第一天7.2

1. ## 配置VScode相关环境

Vscode打开两个项目：ctrl + shift + n

快捷键修改

插件设置

1. ## 熟悉工程项目（**5.1）**

启动两个项目：modelbuilder、web_datamanager（**5.1版本的**modelbuilder的数据治理模块）

启动umijs项目

```Plain
npm run start
```

注册gitlab

**GeoAnalytics Plus 5.1**

https://gaplus-dev.geoscene.cn:6143/gaplus/user/login 

登录禅道、gitlab

liaowq  Geos0702（后面修改了密码）

GAplus：liaowq geoscene1234

## 总结：

第一次实习，要慢慢习惯实际工程的开发模式，vscode配置还是从自己电脑上导过去吧。

实际项目中，代码的复杂度、以及开发流程的规范性在以往的学习中难以接触。所以在实习期间也要不断学习。同时也意识到良好的开发习惯和规范的代码风格对于项目长期维护和开发的重要性，以及多人开发中团队的重要性。

# 第二天7.3

##  1、修改本地git账号

 https://blog.csdn.net/m0_70617073/article/details/130839842

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NDVhMzllODViNjlmOGNlN2YyOTUwNzdkZTc2YTg3NjhfRlNpRldMc1hscnNjZ3NQN0V0bXhvdnRPN0FEazYyakRfVG9rZW46Sm44RWI0U3RIb1ZYdzB4U0x4RWN3NEVEbkJmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. 包括网址，账号，密码，通过：git config user.name查看

1. ##  拉代码、切换分支：

**然后拉6.1的代码：****https://git.geoscene.cn/**

1. git@git.esrichina.com.cn:spatialbds/modelbuilder.git
2. 切换到modelbuilder的src下,拉取下面的文件： git@git.esrichina.com.cn:spatialbds/WebPublicResource.git
3. 之后切换分支：切换到6.1pre分支开发（**拉取的所以项目都切换**）

1. ##  启动项目

1. 修改yarn镜像：yarn config set registry https://registry.npmmirror.com
2. yarn install
3. yarn start
   1.   关于启动问题的解决： 
4. 切换到modelbuilder的src目录下,clone拉取文件： WebPublicResource
5. 如果是 Git 子模块，初始化并更新：

```Bash
git submodule init
git submodule update
```

1. 删除node_modules再重新安装依赖：yarn install

## 总结

在环境配置和代码理解过程中遇到了一些困难，但通过自己的努力和同事导师的帮助，都得到了有效的解决。

此外在使用飞书、git、禅道等协助开发工具进一步熟练。

# 第三天7.4

1. ## 重新修改比例尺数值

```TypeScript
  const getScale = () => {
    if (view) {
      setShowScale(`1:${Math.round(view.scale)}`);  // map加载完就获取
      // 监听视图的 scale 属性变化
      view.watch('scale', (newScale:any) => {
        // 当比例尺变化时，更新显示
        setShowScale(`1:${Math.round(newScale)}`);
      });
    }
  }
```

1. ## 搜索框历史记录

使用SearchInputWithHistory标签，设置里面的searchId="ItemTableSearch"属性

1. ## 解决滚动条压盖问题

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NmI2NTFiMzViNTQ0NmI1N2NmZDM4NWZmMjcwMzY5YzdfSkRxZDIzbE5Xc1oySWpUcG1VTkptN0x4Q1ZNcnBlc1ZfVG9rZW46WHVGTmJ5U3dDb3Fhdm14YW5wc2NNYVhybjdmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

```Plain
style={{
                height: 'calc(100vh - 180px)',
                overflowY: 'auto',
                marginRight: '12px',
              }}
```

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MWU3MTM5ODEwMWZmMWExODU1ZWRlMzZlYTI4MTY0NDlfVm0xVkxMcXN4V3lRQkcxMjhwTmIzNHprQjE3QzZ2QTlfVG9rZW46WTl6NmJONUtOb2pMUzZ4Y1lnQmNTTVE2bnJoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **注册数据项 - 数据表/数据集目录 字段少个”/“**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQ5MWMzNTc5Y2MwMjA5YWQ3ZDA1ZGQyMGY1NDdkMjVfZWVCTWhXWk16emo5czdiMFRYbTZZQVIyRzlzMHB6Q2pfVG9rZW46TzJTU2JQZThTb2hxTEp4VGxDZWNteTJ4bm1kXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

item.path前加/

## 总结：

1. 需求要理解到位，不懂要问清楚，处理需求和修改bug的效率要提升（就是熟悉项目，react、CSS、浏览器调试）。
2. git实际开发大项目时的基本操作需进一步总结。
3. 要提高合作开发的能力（主动沟通能力、git操作、其它相关工具）

# 第四天7.7

1. ## 打开工单-当前只有点点击文件夹来触发，改为点击整个按钮都能触发

把onClick属性从图标组件添加到按钮最外层的组件

1. ## 状态栏优化

将比例尺和坐标显示位置切换

1. ## **任务：增加坐标定位小工具（完成基本工具条的外表样式和功能）：**

使用的是geoscene api for js自带的组件，以及弹框，goto函数。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MjYzODA3ODlkMmVmZDVhOTIwYmNiMDg3NTFmZTgwMjlfRGNzaVhVd0ZkTmI5akE4ellySjlWMzc0ZHNMQW9CRHdfVG9rZW46QkZjVWJFaWxRb2x1VVJ4TkhoQ2M4TTlZblpkXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## 总结：

- 通过修改bug和优化增加功能，进一步熟悉了项目结构和Geoscene api for js、react。
- 遇到的问题：地图控件按钮如何自定义

目前的思路就是

先添加按钮到地图上

# 第五天7.8

1. ### **增加定位小工具**

实现了定位弹框显示坐标和点，跳转放大居中。

根据geoscene api自定义地图控件添加地图上作为工具条显示开关，开启和关闭样式图标改变。

WebPublicResource切换5.1分支，然后提交推送WebPublicResource项目中的修改。

# 第六天7.9

1. ### 解决行业模型数值不对的bug

将数值改为res?.data.length

1. ### 添加切换按钮，绑定首行是否为表头的一个布尔值（hasHead），同时将hasHead传到后端。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM2NTk4YmU0NWEwZjVmMDlmNDQ0ZmQyYzM2Yzg2YTBfblh6NlNRdXpPT3dMYncwV0xzYm5YTUhpa2hzZFkyR05fVG9rZW46TUR1WWI2YlIwb1BGR1J4NTdLRGMwbHNTbnNnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ### 导入5.1版本的项目

1. 拉web_datamanager项目的代码（web_datamanager运行问题）
2. 切换分支（5.1）

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NDM3YzM4OTU0ODhlYzQxOGQ5MTgzNmMxMzljNDdiYzJfSThOVFNTWnptR2VVMkQ5UXkweWtOaWpMS0o3MkhYYUZfVG9rZW46WGYyRmJiTUZ3b2FOMjR4enRyU2NwNnJkbnRnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjVkMWM2NzU4OGNlZDJkNWE3NzZiMTE0YzcwODQwZjVfTEd0bG53M21zbmJRYVp2cVBMN3hGUzdHczJTcmRkTWpfVG9rZW46WlFPR2JQVlI2b0tSWVR4Tk9ZemNpZ1dYbldEXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第七天7.10

1. ### 修复**新建工程的底图被置灰，不可操作的bug**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NGYyMjA1N2FmZDc3MmY1MmE2NjQzNWM1MzE4ZTE1OWZfMnRvQm43cHZFNnpUazFlVDAwNFA4WWhFYUdEZ05WUUJfVG9rZW46T1h3SGJ3WW9Ob1pmQmt4aENXNmNiaXBubjBkXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

修复为：新建工程，工程的底图为空(设为null),不考虑用户自定义底图

# 第八天7.11

1. ### 调整样式，底部不应显示滚动条

样式加overflowX："hidden"

1. ### 工程地图显示定位工具按钮，其他地方不显示

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MWZkNjk4OGMxMjRiY2Y2ZDM5MzE1MzMyMDA0MzAyZTBfSWxYcDJOdmpBbGxpNjJ5UzRZVWN1T1BHRmE5SWtZSGVfVG9rZW46SGZRdWJGbDh5b1IxbVl4WW1PWGNYMmdrbnRiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ### **关于新建功能添加的图层被置灰，不可操作的bug解决方案的思考**

根本原因是用户设置的底图有问题，包括：瓦片url错误、url无效、其它底图配置有问题，建议进一步优化为用户输入如果错误那么提示用户，同时使用系统默认的空白底图或天地图底图。

而如何判断用户设置底图时有无问题，个人觉得应该在后台管理-地图配置的功能模块里去判断，而web_datamanager里没内置后台管理-地图配置的功能模块，所以建议查看后台管理-地图配置的相关代码并加以修改来，实现提前确认和提醒用户设置底图瓦片操作是否有误（加载底图服务会涉及网络的请求响应，可以根据这个来判断）。

# 第九天7.14

1. ### **同时提交2个任务，一个在跑，一个停止，打开停止的仍刷新**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NDI0MGZmY2RjYWNmN2IxOTg0ZGQ1YmIwMTZhMzNkZGZfZkdETUN3WjJQdnhlZVd2N3dqcHNaeFFxcEdzdTREUmNfVG9rZW46UzR6WWJ4YjFjbzR3S0p4NXlHcWNIWk14bmNJXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第十天7.15

1. ## **服务器群组悬浮说明：换行显示服务器名称信息**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NWQ3NDk3YTQ3NWNmYjRiOTNjOTE1OGZiOTU1YTViYTlfWklsQzYxQW1UUmQ2REJWTFV1cFpxNkNwTVQxSWpIV1JfVG9rZW46QUlNNGJmdXJCb1FNRkx4SGZFT2NTbHBUbmpmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **先注册，然后切到数据目录，然后点击全部按钮，数据权限展示异常**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MGMwYmRmZmEzZjc1ODEzNjAzMWQyM2RjZmY5N2VlZWFfcXNISjRRYUhFVmVSaElFOWtBNUluSVdjQXJ3WlhxREhfVG9rZW46UTFIb2JJbFpQb2lDend4VVZkNmNXVWlobkZiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

效果：数据格式和资源池的内容不加载时，那么刷新重新获取再渲染。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=OTU4YzUxMGJlNTk0NDVjMmFhZTA5ZWM4ODBiZjUzZmJfMEQ4d3liVXlUSFBicm14Q0hCempBNlBFc3ZlTnhoeEdfVG9rZW46RUtneGJ2MzdlbzFUTFJ4UUNvTGMwczJobmNnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

关键点：切换组件时调用带showChildSource参数的接口。

## 总结

参与了多个功能优化与Bug修复任务，包括比例尺动态显示、滚动条样式调整、数据表头切换逻辑实现等，深入理解了React+UmiJS框架与GeoScene API的集成应用。通过解决"底图层置灰""坐标定位工具开发"等问题，提升了前端调试和GIS组件封装能力。

团队协作方面，掌握了多分支开发（5.1/6.1pre版本切换）、Git子模块管理及代码评审流程，认识到规范提交和文档记录的重要性。目前存在的不足是对复杂业务逻辑的理解效率有待提高，后续需加强技术预研（如地图服务校验机制）和主动沟通。

# 第11天7.16

1. ## 增加定位功能，优化效果为：

状态栏为底部全铺满，

比例提供快捷设置，和其他功能数值保持一致

定位功能按钮在状态栏，开启的时候鼠标位置区挪动到右侧

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YWUzNjg3MTlmYjFmNGQ0NmI3NmEyZTc5N2Y2MGQ3YzRfZEpZbVZnODBQOTRQcGIwZndVRVZ4N3lGVFpyeHhpYnJfVG9rZW46VW1VNWIxckJQb2pYbzV4SUdJUmN0eXVxbjZyXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **数据资源，页数切换异常**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NWRhYzlhNzYyZDQ0M2JkMDVlZmU0Mjc0MmJmMWM5MmZfZHF0UDBhckJUZ1lITW9OZ2lMWFZpUnFKZUVycmV4anpfVG9rZW46S2ZLaWJ5TkRub25mb3F4VEEwYWM3bWVCbkJoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **5.1版本模型库-行业模型总数值不对**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NTNjYWVlYThkNjIwNTM3YmVhMjRkMTc1YjA3MTI2MjZfQUJpc01leHNHSmhCR2ZmUHBHMGZLdUZVZXdqN0FxTDJfVG9rZW46WjhDNGJNdHVObzN3Rkt4Tnp3MGMxUjhzbnJmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第12天7.17

##  **底图配置时，地址传空做为无底图配置用**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NDZhNzIwMTAyN2Q1NTY0NzdjYzc0OWU3ZmUyMjkzNzFfTkloMDRzUDk0bEFqbUF0a3ZjQk5TSmpDR1R4Y29zMTBfVG9rZW46SEZzUmJPOENnb1FvRFl4Ukd1ZGM2d21CbjVlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWQyZTI1Y2FlZDE1ZWJlZDhhNzE4MWYyYmRmMjliNTRfRzlyNWI2M2NyczlhV2hjSXZxTGYySEhEUzcxT1ViR0lfVG9rZW46TUJuV2IyaTJxb1M5UnB4eGszYWNCcjRZbmlmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第13天7.18

1. ## 任务日志窗口打开异常

改代理没问题

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NzA0YjE4MDJkOThjOWY5NmNmMTc0MjAyYzM1Y2RiZWJfNDJpWjdVV0ZoOGVCNEJlV0JiUjNVSFc4MDUwMnYxdTZfVG9rZW46QnFrZWJOclBwb2ZtcnN4SGFKZGNjZ1dBblRlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## 【坐标系】切换坐标系报错

开始响应500，反映之后不报错

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MjY5OTAyNGJhY2NmOTBjNDBhZjhjYTkzNWM0NTc2OTFfcGFXdFQ5MFRZZWcyWGFjbm16aElCUW9Fc0lOeFFFQURfVG9rZW46VWtEbGJ4TWFtb2Z1ZWl4Z0pZUGN1S2oyblpnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjBjOTM3YTQ3NjJiZTM2NDM5OTIzOGIyMWUxZGU0NjFfTjROTjBYcTA0V2JRZUZvR2pUN1pBRWhDakRvYWZjQjNfVG9rZW46Tk93SGJzdk5Ib0JSQ2N4dVcyVWN2aGk1bnE4XzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## 资源池注册页面刷新按钮，有延时，还在刷新

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NjMwNDhiNTBlYjUxNWJiYTNlNjBmNGRiMDNhZGIwNTBfa0lwbW5nUE9IR2dqYVlpSnM0UlBWZ0k5N3VlQjQxUnFfVG9rZW46RDFCU2JIT0tUb3JrSkh4U3g4NGMwcm96blBmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MTAzMjhiYjc4ZWZmNDVhZTUyMTJiZDY0YTE2MDlkMjRfc0hIc3FYVGU0MlIySGQ1WEdORkJsYzdxYWZuUW5kUk1fVG9rZW46RFYwSGJWaDNob1R4bnJ4TTNzVGM4a0pmbkVjXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第14天7.21

## **资源池注册页面新增的数据，更新状态先提示新增然后消失**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ODNlOGM1YjgzNjgzYjIyYzc2YzYwODI1ZTA1MDFjMDFfdWIwYnhPWW5jRW00UVBXTEJXSk1VNlQ1NzJaUjhOSW5fVG9rZW46SklkUGJnUlp2b3JOMnB4ZW5zSGNyN2xPbnFmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YWE4M2U2MjgwOWQwZjE3MjIyOTZlNDE0ZGUyYjljZmRfWHpLQkVUUHJRa0NoREJJOG9ranFaTEJIY3V4MnJvblFfVG9rZW46WHE1ZGJ6dlZBb3psakh4VUIzU2M2TzJ4bkFlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

新添加数据后打开注册数据项查看响应内容，发现新增数据项的newitem（非gdb格式）、newitemcount（gdb格式）字段为false和0，前端就不会渲染。

## **状态栏样式调整**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YzViNDRlMmJjZTJjOTg3ZTMwMmY5ZWZmMDhhMDExNjZfaHA1VUhMSExrOWh4RmdpTGdzVDBiSXJGZGNxYkFWWGRfVG9rZW46WVhCY2JXZ2Z4b012WjR4NkRGTGN6RTU2bmRoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWExYWJhNWEwZDdiM2I2NzM5NDJlZTZiODJiMTQzMzhfVUFaZ2tjaDBxZ2haMk9EYURvblBSZk01M3lnT0ZWbmdfVG9rZW46VXZETWJCcmMzb2RrSEh4NXdJY2N5dmgzblVjXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第15天7.22

## 图层过滤

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MWM5ZmM0OWY5ZGIzZDc1OTQ5YjIyMjdjYTI4MDNmMTFfajRTaW1waXg4NmdtMllDZ0hEUEpPVm5SMTdkMXlHeE5fVG9rZW46WHJrVWI5dzhTb0hUZTR4Z3lRVGNYZk4yblZiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MTA1MDdmNjI2YzQwM2NkMGZmN2YwNGNhMTY1NTIyZTRfQ0tXV2hMM094emxQSGllNFIzRXpBR1pEdk8wNjROM3ZfVG9rZW46U2NnemJMWlVIb3ZVc1J4cGVibmNVNXVXbklnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmI3NTE0ZGYzMzllZmQ4MDkyYjQyNzk1NTE3OTNmYzJfSWM5Z0FaSGpJNGgwTDI1V2l3TWh6NGNBTmFqODE3bWRfVG9rZW46WWVVcGI2dmhZb1B1d1l4amNMTGNvUm91bjlnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第16天7.23

##  **shp数据配置时间后不显示**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MThiOGU3NmE5NGQwNjNkZDEyYWRjMGVjYjQ3MDUxYjdfb05VdDUwdmpFSVFRdVBTaDhXYlRHSXNvOXIxaTZDd25fVG9rZW46UGNVdGJBSnpQb0VmZDl4dlByU2NHZFdTbmlvXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

 配置了时间字段读取Shapefile就读取不了，由于这里时间轴显示精确到了时分秒，Shapefile 只能是精确到日期之后的时分秒全为0，所以就加载不了Shapefile，且不建议使用 Shapefile配置时间。

## 支持通过输入url方式添加图层

### 需求概述

通过url直接添加数据到地图，并展示对应的功能信息（参考desktop）

### 支持添加：

- 地图服务图层
- 要素图层
- 切片图层（底图/影像服务）

### 完成效果

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NTIzZjM5YjU2ZGRmN2VhMWE2Y2VlZjYzYTFkNDdlNDRfTjY4VWpCU2RnbHdqQVB6M0ROUkZZR3d4S1NxOVRoTUtfVG9rZW46T05lcmJTWEhSb1ZuYmh4QkNnZWNraHRWbm5mXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MjYzYTg1OWVmZGEzOWE2NjI4ODg4YzcyN2RjMGI1MWRfWkRuSzNUSDdsRzZlMnFLelF5Q3JjSzJOSmo4THU3ZEZfVG9rZW46RWp6WmJoWDBtb0ZWcW14SVJ0S2NMQ2RKbmJmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YjA3NjFiNDE5MDMxNTkxZmVlMThhODJiODdjOGViZWVfdkxMU3ZCRURJakhwcXl6MVdDSVNTaThMcUJobVdtMUVfVG9rZW46T05NMGJCN1pob0ZEYnV4akRHWWNRQXIxbmpmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

默认使用代理让后端去处理和请求地图url获取图层数据，后端响应正常但状态码为为500，获取不到图层资源

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NWQ4NDQ5YjhhZGM5ZjZjMGZmYjljOTA3OGNiYTlhYzRfVWdpZDBGaFc1QThaQ2VjbHNYdUdMT3MyV2pFTWpqSWtfVG9rZW46VGM5cmJtblBtb3VrRUZ4Mkp4cmN4MzdMbkVnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第17天7.24

## **批量移除共享应该不生效实际生效**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MTYxYTczOWRiZGY0YzYzNWM1NDlmMmIyM2Q2MjQ4ZWVfbklESlBaYzFjNjVxNGRVcVphb1cxUXpramptcWN6ZFVfVG9rZW46VjFva2JPSnNxb2hoblZ4blB2Q2NUc292blJoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

**参考移除按钮是否显示的代码判断是否可移除**

### 修复效果如下

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=OGQxNGVlZGU5OWZiN2NmYTkwOGY5OTgzZDc1M2NjNGJfQmZUZ2JqVG90NDUyTzlIV2tsMm5YT2pSZmNTd2RHcDdfVG9rZW46WndPMmJqeGdab21yRGl4S0YwWmNFMVVnbktiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NTc2ZTlmMTNhYTVkYmQzN2QzMzI5YTU2YzFlZGUzYjJfbHo2S1J1VWRlWXJjd1gwRzROd0Q5QTBSbU1DcTdYWDdfVG9rZW46QUthWGJjbFFMb2d3dHZ4c0hIS2NURW5qbnVmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## **状态栏比例尺，点击切换时，显示数值和列表中数值不一致**

获取的是WMTS底图比例尺，由于WMTS金字塔瓦片的结构所以不能完全精确加载特定数值的比例尺，所以改view.scale = value为异步

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MmM1OTVmNjA2ODY0NWY0MjY1YmM5MWEyNDJkNzQyNzVfTVZNNVQxclhzVXpvUWRhN0NDNEQ5RU1JUUNSZ0tIQ2NfVG9rZW46TWhRMmJjTXZZbzhwb2V4b295aGN2WWl0bnlmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第18天7.25

地图服务测试url：[6.1测试，通过url添加](https://yaroloh1wzo.feishu.cn/wiki/XtNawqZDCiRhD3kGmHEck00znZe)

## **通过url添加的图层，图层属性集合类型缺失**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjg2NDRlZmYzMDI4Mzk1NjUwZjk5NThjOGY2NDU0NjJfd2ZUbndUM05ZVk5ra3dpN2xkMHEwUlg1SWcwVFFrb3JfVG9rZW46QnhPd2JyMjQ2b05NcDV4UTNPR2NwWTVXbjRmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

https://gaplus.geoscene.cn/server/rest/services/51gaplus/%E6%9C%8D%E5%8A%A1%E8%A6%86%E7%9B%96%E6%B5%8B%E8%AF%95/MapServer

## 去除多余按钮

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ODQ0MDljMDBiN2EwNjE0OWM5NTA0ZmNkMDE5M2JiYThfbGVOaU5lNHlKOTF2RkFKVDQzR29XdFlXY1RDTjhNWlRfVG9rZW46QUVXSWJOQW1lb0tRRVN4dHBxYWNuMXVtblZjXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

没显示多余按钮

## 图层过滤第一个是输入后只能选下拉中的，第二个是输入后可以不是下拉中的

第一个是输入后只能选下拉中的，第二个是输入后可以不是下拉中的。

## 本周总结

经过几个星期的工作，对项目工程结构有了深入的理解，这个星期把通过URL添加底图的功能引入到6.1项目里来。

但经过功能测试，该功能在具体的一些场景下还有明显的缺陷，对此，准备下一周解决。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MDEzZTU2NjUzM2IyNWMwMDNlNzdhMWQyMDljYjYxYzhfd0hrY2ZkVHJXV1NETFdpYzJ3dE9Md0lFQ2hDRlZEN3hfVG9rZW46QkZiU2J1djBFb2toVWh4TlA1S2N5RUdabmFmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

由于部分涉及到地图渲染失败的问题，在调试上有较大难度，需要深入理解GeoScene api地图加载的一些细节，以及geoscene发布地图服务的相关原理和特点（把什么参数响应到前端、异步加载、服务请求跨域）。

最后也应该注意一个bug如果反复想怎么改还没发现什么原因，赶快看下一个bug，由易到难，之后团队交流交流，回头再想想原因，确保效率的提升。

# 第19天7.28

上午由于服务器维修，查看了GeoScene SDK 的相关文档，了解到图层过滤的相关API的使用，以及通过console.log(layer)查看各类型图层里面的参数特征，为之后的项目优化相关任务做准备。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjc1NTg5NzYyMDE2ZWQ3YzJkNjE5NzYyMWQ2M2NhNjBfYUluMEhYaXJVRlBIM1JrbWNxNXo0SEVONW5kMG5xQmlfVG9rZW46VUN4ZWIxUHZIb0RSb1J4VnRJWWNaa1FpbndiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **通过url添加的图层，矢量切片服务未正常获取图层名称和图例**

通过使用decodeURIComponent来解码图层名称

已完成图层名称的正常显示：

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NTc5M2ZiNjY3OGZhODk2NTU4M2Q1ZTQyNmQwNjgxZGVfa3p5RFVMSUxUTGtPT1FwVWt6VGlCcklWQ1cxS1BUUkpfVG9rZW46VlFudWJjaDdZb0pLQWF4UFQwa2NUdDRObmZoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

至于图例获取，由于是使用Legend构造函数创建图例，但是geoscene api不支持矢量瓦片的图例加载。

https://doc.geoscene.cn/javascript/4.29/api-reference/geoscene-widgets-Legend.html

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=OWIxY2M0ZTI2Mjk3NDM2YTYwODg1MGEyNTg2N2M0YjZfMzM2N2VnZWdTbHNuVFZUOXF0Y1U2b0FuWmxQU2Q5QWZfVG9rZW46UG00RmJEUTZub0JLdk94R01KY2NKUUJYblBnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## **2.****通过url添加的图层，矢量切片图层列表样式异常**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=OTdiNmE4ZmE4OGI4MDAwOGQ1OGU5NzJjOGRmN2NiMWNfWEhVZDRUbFgzdWJjT0ZUeTZYM1I4VXJ0ZEp3eTVndUVfVG9rZW46SUtHRGI2aGZxb2ZqY0F4dHgxZGNFYlpJbnBoXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ##  **通过url添加的图层，影像服务不应有属性表、数据洞察、注记等功能**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MDFiZTg3MzRjODRiYzVlZTZmZjI4MTllY2E3NjExMGZfbGVjVUVTM1oySkVXd2JtTmlrU3VEb0oyMjR5S1RZUk9fVG9rZW46QTJkQWJ2VmcwbzU3YTd4UDB3YWNpZkxObjhnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ##  **通过url添加的图层，影像服务未正常获取图层名称和图例**

**具有波段的影像底图图例的显示**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YjI5ZTcwOWQ0NzcxNDdhOWRlZjU1YWZlMTc5NmNmMjNfdmZpdWt1blZ5a2tld1k5enJDUkdDaWNVdDk3NWdaWDhfVG9rZW46WmNldWJ0Z0Rjb05uNnh4UDFuWWNrRUR0bk5kXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MGExYTJhNmJmZGZjMTllYWQ1MzExMDI4ZGQ3MDk4NzhfRWwySmNOdWdDQ0FVYUZSa3VHc1VzamJka0JXUXVFeDlfVG9rZW46UHpWWGJKdlh6b2d4Q3h4ZGowQWM1djM1bjJjXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YTNiZjcyOGJkZGVkNzU5ODM4OTY3N2ZjYWU3Y2NmMGRfOGtnbUlDam15WFNlT212QVlOYkYxT1hvcVoySFpXWFpfVG9rZW46WVp2NmIwTEtmb1dmTHV4WTRJOGN2WG1FbnRnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第20天7.29

1.过滤条件的顺序不一样，过滤后数据数量不一样

2.下拉输入和清空需要优化

1. ## **状态栏，定位工具，关闭后清空**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ODVkYTMwYWNkMGJjMDI2MjJjNTllZWUyMzA1OGFjZGJfcFh2S1kwUktva1JNanJqZU1UVEhUQzk1WWRnYk13VnZfVG9rZW46UWhqMmI2MktXbzNYTld4enJiemNTM2lWblVmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **图层过滤添加下拉并支持输入功能**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NjU4NzUzYWZiOTFlMTEwZDQ4MmNjZTdjNTVkMjRjYzBfVUdQa21JSkdsc0dZbjgzNXFZVVdLbFFnWTd2Y0VXQkJfVG9rZW46TUJqQmJyUVk3bzNodjZ4WnVaY2NBU1RTbmJlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第21天7.30

## **状态栏优化位置，底部有缝隙，直接定位到最底端**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MGY4ZjEzNThhZDJkN2ZlNWJiNzFlZGQ0ZWFjNzE2MGRfZ3RlZlFpYndhZTFEckxNMDVZRTQ0UGxTY1FxOG5aT21fVG9rZW46V0lwMGJwTE9pbzc5UEl4ekY3UGMwQ0dubmZlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## **状态栏，请优化内容超出窗口显示范围效果**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NjAyMDNmZjc0MTlkYWI1OWQxZmZkMjY3ODg4YmNlNDFfNVlQVGVkbU9iOVp3VmZ2N2tEMUZZejROWTI0MVlGNnBfVG9rZW46QVdJS2JCa01Ob1N6M0t4RmpuS2NWbW92bmVwXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## **状态栏，定位，优化窗口显示效果**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=OGNhODUwYjVhOTZkM2VlMzAyMDU3YzAzNGQyYzk3NDlfdXBheThSSG5vQTJ3UmMzOTU4MEhQZndMSUR3a1hEdnRfVG9rZW46T3hPbGJhSVM3bzdmTEZ4bjMzTWM3YVBDbkNnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## **状态栏，定位输入框粘贴无反应**

移除输入时校验数值，点击显示弹框和定位并放大才校验

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YTk3ZDIxM2RhYzA4MWI2YTBlZDMyOWE2NjFlZWUxMTZfbUNzaUVBaUlqc0xmb0lOWHg0ajNIQTdQSVVzQXNLazhfVG9rZW46TjhON2JGaDhhbzBud2h4RXBoU2NXQTZRblNiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NjhjYTM5YjZjZjVlZGMzZjJmMWNhOTIyOGY3YzVjNTBfYldoUWtiakpIMWt2ajhqZzFOR29MSnRSUnRHTUdUSjNfVG9rZW46VFpEeGJHaDBib0daNGN4TDZHamNXeXRYbmRjXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## 修改输入地理坐标数值校验

输入完点击才提示是否有问题

## **影像服务的坐标系、值域显示异常**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MjczOTBhOGYxZGE3YTcyZDVkNjViYzAwOTIyMmU2NWZfZm4zcVR4c2laQzhYWDd6U3dna20wQTNaYktiOXRyQXdfVG9rZW46UzFjZWJhUUJzb2l3SEp4MkZEYWNPeXNvbjM2XzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第22天7.31

1. ## **图层过滤，配置图层过滤后，点属性表的图层过滤，直接弹图层过滤**

图层过滤相关

```TypeScript
    const QueryBySql1 = () => {
        console.log("所有字段信息为：", layers[1].fields.slice(1).map(field => field.name));
        const query = layers[1].createQuery();
        query.where = "矿产地名称 LIKE '%金矿%'"; // 只用于查询出具体的结果，不会返回到地图上/**
        * 配置统计分析参数
        * @param statisticType 统计类型，此处设置为"count"表示进行计数统计
        * @param onStatisticField 用于统计的字段名称
        * @param outStatisticFieldName 输出统计结果的字段名称，此处固定为"count"
        */
        query.outStatistics = [{
            statisticType: "count",
            onStatisticField: '矿产地名称',
            outStatisticFieldName: "count"
        }];
        query.groupByFieldsForStatistics = ['矿产地名称'];
        layers[1].queryFeatures(query).then(function (result) {
            const values = result.features.map(feature => feature.attributes['矿产地名称']);
            console.log('字有唯一值:', values);
        });
        layers[1].definitionExpression = "规模 = '小型'";  // definitionExpression = ''   会直接将查询结果返回到layer上
    };
```

**使用definitionExpression查询优点：速度快，并且能保持图层的抽稀效果。如果通过其他方式查询数据回来****客户端****构建图层图形渲染，渲染速度会非常慢。**

1. ## **添加快速将当前配置的过滤条件清除**

增加了图层过滤条件快速移除按钮

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmEwYWQxMTg0NzdlNzVhZmY4NjkyNjc0NmQxZGM0NmZfYlczUFMwQ080SVpjMDJtWG5yVzFHV2hBUldWSkVtclpfVG9rZW46QkZNS2JGYk5jb0JwY1Z4SUUwa2Nnc1dybnhnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第23天8.1

1. ## **图层过滤，原数据过滤功能隐藏**

最后只能通过属性表点击图层过滤或点击图层属性才可以看到图层过滤界面

1. ## **图层过滤，配置后关闭，打开另一份数据内容清空**

通过清空代码里的SQL状态列表filterExpression

1. ##  **通过url添加的图层，地图服务集图层不能使用的隐藏**

没有字段信息的就不能使用图层过滤

1. ## 定位点弹窗改为GeoScene API原生样式

## 本周总结：

主要完成了图层过滤、状态栏优化、URL添加各种类型图层的问题，

- 关于状态栏优化的差不多完成了
- 通过url添加各种图层本周主要完成了各种图层属性字段渲染到属性表里所出现的问题（主要是因为图层类型太多了，情况也比较多，主要逻辑就是一个属性渲染不出来就在 || （翻看对象里的字段去找）），之后就是图层渲染不出来的问题了。
- 图层过滤逻辑改了点，使用（definitionExpression后接SQL表达式），基本的功能有了。

# 第24天8.4

1. ## **图层过滤，最新版，多选配置后异常**

多选时要注意SQL语句的执行优先级和一些原则，and优先级大于or，所以先执行and两边的再执行or，以及and是查询都满足条件的，or是查询满足其中一个条件的。

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NWQwNThmYTVkMDQzNzAyYjcxNjY0MWFiZDRhZTI4YzNfMXFkdXNNM2ltN0FZUEU5bmZuOE9xbVUybWtiTEl6eFNfVG9rZW46WXpKT2J3WGxDb1pmNDN4blZ6VWNyU2NwbjJnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## 图层过滤后，属性表，总数变了，但内容没变，请保持一致

执行过滤的同时添加一个useEffect函数，看layer.definitionExpression有没有改变

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YWJiNTgyYmZkMWUxNGYzZmY1MmRlZDc3M2Y5ODYwY2NfdFhXNjN1Y0NjVndyMmV2TXRZVFVFZktDVTN3MThneGhfVG9rZW46R0U2N2JaVDNVbzVweE14emZrOGNkZlExblFiXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **图层过滤，请确认下方图层过滤条件和结果是否正确？即条件是否有顺序要求？**

由于该功能底层使通过sql语句的where部分来进行条件筛选的，所以就遵循SQL语句的规则，大概就是：

`WHERE` 子句中的条件通常由逻辑运算符（如 `AND`、`OR`、`NOT`）连接。这些逻辑运算符的优先级如下：

NOT  >  AND  >  OR

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NDUxY2FkMDE0YTg3NjVlYzg4ZDM2YzM2MDNhODhlZDBfZ2NjcmwzQkFTdmdlamNsUHc1QWs3enpuRTg0RGtnRjFfVG9rZW46QWtEOGJGVnpPb2hrZFd4eDdhZ2NCRGY2bjVkXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

Where a or b and c

相当于 

Where a or (b and c),

如果一定要按照写的先后顺序，那么要这样写：

Where (a or b) and c

# 第25天8.5

1. ## **图层过滤，属性表异常，点击刷新无反应**

属性表显示数据

1. ## **图层属性中，容差和分辨率不用科学计数法**

参考GeoScenePro显示界面完成

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NjQ5NmI2MDQyODRlMTFhMmQyOTVjZmZjZjU5YjhiNjlfVlE5cVQ4dXlGOEo3QllHU0lLeUZnWlI5dTFLZEpPYXZfVG9rZW46T1VONGI0czBYbzZYNXd4UUlIcGMwSnRSbk5oXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **图层属性中，隐藏z和m值内容**

1. ## **属性表下方多出来一条线清除**

1. ## 通过url添加图层，图层属性里显示空间参考系的具体信息

1. ## **配置图层过滤后，添加图层已配置过滤的标识**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Mjg0N2QyZjQxMzIwOTRkZmI2ZDQyMDVmOGZkOWU4ZTdfYkRhbzNvVGE1SUh2WEd5RWhsQmludGU1NGkwdU1OR09fVG9rZW46SkRPWmJiakN2b2FaQ2t4NHN0NmNIT1FGbkplXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第26天8.6

1. ## **图层过滤，清空全部按钮优化**

改为点击清空图层不会立即显示全部，只有再点一下应用才会。

1. ## **图层过滤出现过滤后结果为0的情况，下面的表格中内容不会刷新为空**

修改数据更新的逻辑

1. ## **图层过滤，和条件过滤中参数统一**

1. ## 导入proj4库，处理坐标系的wkt数据，让图层属性里的参考系信息显示

- https://gaplus.geoscene.cn/server/rest/services/yunnan_tiff_imager/ImageServer

解析WKID的接口：http://localhost:8002/api/bigdatamanager/spatialrefsys/queryBySrid?srid=4000

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=NGYzMWIwZDMwYjYxNmUyZGQ2Nzc4YjcyMDJjMTk4MmNfRW5ITFlnNk5ZMTY5YmNsbnRXVGpSenRtdms3T2VNM2VfVG9rZW46S2c5cWIwVTVOb255a014SXEyd2NaSFl5bmxlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

没有参考系的wkt值，就不知道这些参考系信息

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MzIzYjdhZjdjYzkzYzIyYjY0MGZhM2I2MjhkNGZjZGJfdmJISnVuZHlXbEZGZmJRTmlNa0w3U0hvblFlRzNDYnBfVG9rZW46Q1RxWGJjRmtib1EwTE14SXptR2NaSm9ibjdmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YzQxNDU4MTczZjgzMGI1NzczMTQyY2E5YTQwNTQxMmNfMmZKbnVDRW5mWUxQd2wzQ1ZaSGJQYnBaOFcwTkVURnNfVG9rZW46VExrRGJwOVdKb1Vvb2Z4R2E2MmNWcFpTbnZmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MGNhNWYyZTNmZGYxM2Q0N2JjNGQ1ZGViODBkNTkwOTFfUmhTVmxpYUY5d0EwTG1TQkg0M3RhTkd4dnk0SGVtUW9fVG9rZW46WUJuZWJDdzMyb3JZcU54UzluVmNHSXR6bmpkXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

有的显示空白是因为给的json里没有这个字段，别的地方也找不到字段值，pro里可以显示可能是它桌面端就存储了所有wkid信息，一个wkid就对应一种固定的空间参考系，前端这要得到的话可能还是得要后端提供接口

但是由于部分数据只给一个wkid，所有也就只知道wkid，对此，需要后端提供相关数据。

同时认识到了，一个wkid对应一个空间参考系，wkid是能表示所有的坐标系，比EPSG还广泛。

https://developers.arcgis.com/javascript/3/jshelp/gcs.html

https://developers.arcgis.com/javascript/3/jshelp/pcs.html

# 第27天8.7

1. ## **图层过滤，配置后关闭，打开另一份数据内容未清空**

① 点击应用过滤条件是将filterExpression和filterConnections赋值给当前layer对象（对象里添加这两个键值对）

② 开启过滤窗口的时候更新两者的状态：

setFilterConnections(layer.filterConnections || ["AND"]);

​      setFilterExpression(layer.filterExpression || [['', '', null]]);

1. ## **图层过滤，下拉值异常**

1. ## **通过url添加的图层，数据类型显示异常**

# 第28天8.8

1. ## 图层过滤：过滤结果同步到数据洞察的图表里

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ODgyNTEwOTFkYWI0NGM1ZGE2ZjExY2EzNDc1MTk0OGRfdDh3a0Q4VjVLdUlLMHAxMHV6dld6U2JJZllDVHhqVnhfVG9rZW46UDdjNWJXTzFhb2JBNVZ4MjYyM2N4T0M0bjliXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## **打印数据算子：展开后换行展示出现横向滚动条**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MGYwN2Y2MmU1NjJlZWMwYmVjZjkyNDA4NDMzMTZlY2ZfeFRIOEtES0FGMDJUWGtlaG9xck9oOWlTZmFXZlQ5Z1FfVG9rZW46T2l4VGI1NktZb253dFN4MUR1RmNkRENjbkdlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDgyZWI3OWM4YjQ0ZTliNGFlNzk3MGZkMzcwMWYyMjdfZkhiM0xHOGlFTW9ZRFNKUHpadWl1a004N2RzYlAyYnVfVG9rZW46UHNxeWJUdnRKb1k4Wld4UmJkYWN3MVU3bllmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

## 本周总结

绝大部分都是在搞图层过滤的那个功能，解决了些明显的问题，过滤结果和字段表、数据洞察图表、条件过滤表同步，还有切换图层再进行图层过滤的一些问题

此外还有URL添加各种各样的图层类型所出现的问题，由于图层类型太多了，图层数据本身情况也非常多，属性显示出问题的原因也多种多样。

但是经过之前修复bug的经验，大致熟悉了Esri标准layer的一些特点，加上详细学习GeoScene API文档并通过具体的例子，还是有一定经验的。

# 第29天8.11

1. ## **通过url添加的图层，矢量切片点击按钮无效，缺少图层属性按钮**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=YWMzMDBlZDkwYjNjMDA0YzY2NjI2NGMzODZjMTk2ODlfaE5TRFBzU2ZpbVF6aW5CZVpJSW9uQzZDeTdZcWN2aXhfVG9rZW46RGRyWmJ1cHNBbzIzZ0p4alUySGNiUkxEbjRlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

https://gaplus.geoscene.cn/server/rest/services/Hosted/yunnan_tiff_qp/MapServer/tile/{z}/{y}/{x}

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGVjZjg1MzBlMjVmNTdjNjFhZmQ1YzYxODgzZDkzMzVfcXpIYllVZXV4UW1INzMzamZUYkJFZDNmN2dBODZObFZfVG9rZW46UklNOGJtTUpQb05HbUh4SVAwMGNWb0NpbkRlXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## 图例显示隐藏规则保持一致

改为只有开启图层的显示才能打开和查看图例，关闭图层显示不能打开查看图例

1. ## **通过url添加的图层，矢量切片图层列表样式异常**

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2Y3YjgwNGY0NmRlM2ZiMzdmOGJhY2FkYzJkYmI0OGJfOW14T0p1NU0xdFBDSTVMZENyQ0FNd01qelpuNnNPOURfVG9rZW46VU8yR2J3RmdUb0JLdlV4TXVseGNtWkVvbnVmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

改为如果**portal按钮**可以点击的，那么就可以显示，点击不了就显示不了

1. ## **通过url添加的图层，快显添加失败，无反应（外部GIS地图服务器的原因）**

# 第30天8.12

1. ## **图层过滤，数据参数获取异常，出现重复数据**

1. ## **通过url添加矢量瓦片图层报错**

引入fromGeoSceneServerUrl的方式添加weburl图层

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MTEzNTViYTJkYjVkMjJmNWQ3ZDhkYTYyYzRhMDgxNzlfcTE3dXQyRTlCUTI0RmFreUY3QmREcEk4Tm1yUTNMbEdfVG9rZW46R2VJN2J3dWVmb1lxNFN4UHV0UmNwMU14blNnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=MDM3MmU3YWY4NTNmNWNlYjQ4ZjZkODVlY2QwMjFiZDRfUnFPMGJFNWEwczVFYnZmeHhFdDEzdFNscWRkRGhBMmxfVG9rZW46WVl4cmJCV3dtb3k1Rkp4T3hscGMwV0RUbk9vXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

# 第31天8.13

1. ## 将Unix时间戳转为具体时间

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=ODllMzczMzdiOTdkNTliNjQ4ZTc3YTE1OTM2MmE2MmZfZkNXblVlWlRDNFk4WW9wOFhrRGZnODhKWXZ3U29TUHBfVG9rZW46TzBlWWJNRXpib0lmZzN4OHY0ZmMyN2t0bnBnXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

1. ## 图层过滤时间配置生效

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2Y2Zjg3YzE5YjEwZmQ3YzdmNjc2NTcyMDUyZTdlOGNfcUJjNWtIVkhhZFp0V3NSbWhlTlFmcGZXcmlCaWVmbXhfVG9rZW46TkNUWmJCb29ib1QxSG14ZHdaZGNFMW1XblliXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)

https://www.geosceneonline.cn/server/rest/services/Hosted/%E5%85%AB%E5%8D%81%E5%A4%A9%E7%8E%AF%E6%B8%B8%E5%9C%B0%E7%90%83%E2%80%94%E2%80%94%E8%88%AA%E7%BA%BF/FeatureServer/0

![img](https://yaroloh1wzo.feishu.cn/space/api/box/stream/download/asynccode/?code=Mjc3NjNiZWM5ZGIwOGU2MmRlMmNhNzk0MDg4YTE0YjVfNkdveThna0E2eDBBZWlIYzRzbFdiNk94NXRCTXFzc1JfVG9rZW46SXptcmJMaU5Eb25YUHl4N0M4bWNHajQ4bmlmXzE3NTUwOTE4MjM6MTc1NTA5NTQyM19WNA)